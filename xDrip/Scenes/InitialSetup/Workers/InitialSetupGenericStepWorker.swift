//
//  InitialSetupGenericStepWorker.swift
//  xDrip
//
//  Created by Artem Kalmykov on 28.03.2020.
//  Copyright (c) 2020 Faifly. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

final class InitialSetupGenericStepWorker: InitialSetupStepProvidingWorker {
    private var currentStep: InitialSetup.GenericStep? = .intro
    
    func completeStep() {
        guard let step = currentStep else { return }
        
        switch step {
        case .intro:
            currentStep = .deviceMode
            
        case .deviceMode:
            switch User.current.settings.deviceMode {
            case .main: currentStep = .injectionType
            case .follower: currentStep = nil
            }
            
        case .injectionType:
            currentStep = .settings
            
        case .settings:
            currentStep = .transmitterType
            
        case .transmitterType:
            currentStep = nil
        }
    }
    
    var nextStep: InitialSetupStep? {
        return currentStep
    }
    
    func initConnectionStep() {}
}

extension InitialSetup.GenericStep: InitialSetupStep {
    func createViewController() -> InitialSetupAbstractStepViewController {
        switch self {
        case .intro: return InitialSetupIntroViewController()
        case .deviceMode: return InitialSetupDeviceModeViewController()
        case .injectionType: return InitialSetupInjectionTypeViewController()
        case .settings: return InitialSetupSettingsViewController()
        case .transmitterType: return InitialSetupTransmitterTypeViewController()
        }
    }
}
