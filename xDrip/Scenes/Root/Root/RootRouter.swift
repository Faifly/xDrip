//
//  RootRouter.swift
//  xDrip
//
//  Created by Artem Kalmykov on 23.02.2020.
//  Copyright (c) 2020 Faifly. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol RootRoutingLogic {
    func routeToCalibration()
    func routeToStats()
    func routeToHistory()
    func routeToSettings()
    
    func routeToAddEntry()
    func routeToInitialSetup()
    
    func showCalibrationError(title: String, message: String)
}

protocol RootDataPassing {
    var dataStore: RootDataStore? { get }
}

final class RootRouter: RootRoutingLogic, RootDataPassing {
    weak var viewController: RootViewController?
    weak var dataStore: RootDataStore?
    
    // MARK: Routing
    
    func routeToCalibration() {
        presentViewController(EditCalibrationViewController())
    }
    
    func routeToStats() {
        presentViewController(StatsRootViewController())
    }
    
    func routeToHistory() {
        presentViewController(HistoryRootViewController())
    }
    
    func routeToSettings() {
        let splitViewController = SettingsSplitViewController()
        splitViewController.viewControllers = [
            SettingsRootViewController().embedInNavigation(), SettingsChartViewController().embedInNavigation()
        ]
        
        #if targetEnvironment(macCatalyst)
        splitViewController.modalPresentationStyle = .fullScreen
        #else
        if UIDevice.current.userInterfaceIdiom == .pad {
            splitViewController.modalPresentationStyle = .fullScreen
        }
        #endif
        
        viewController?.present(splitViewController, animated: true)
    }
    
    func routeToAddEntry() {        
    }
    
    func routeToInitialSetup() {
        let viewController = InitialSetupViewController()
        self.viewController?.present(viewController, animated: true, completion: nil)
    }
    
    private func presentViewController(_ viewController: UIViewController) {
        self.viewController?.present(viewController.embedInNavigation(), animated: true, completion: nil)
    }
    
    func showCalibrationError(title: String, message: String) {
        let alert = UIAlertController(title: title, message: message, preferredStyle: .alert)
        let action = UIAlertAction(title: "OK".localized, style: .cancel)
        alert.addAction(action)
        viewController?.present(alert, animated: true, completion: nil)
    }
}
